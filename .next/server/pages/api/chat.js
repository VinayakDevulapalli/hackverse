"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat";
exports.ids = ["pages/api/chat"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/chat.js */ \"(api)/./pages/api/chat.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/chat\",\n        pathname: \"/api/chat\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNoYXQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmNoYXQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDZ0Q7QUFDaEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYW5rLXN0YXRlbWVudC1yZWFkZXIvP2Y0MWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9jaGF0LmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2hhdFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NoYXRcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/chat.js":
/*!***************************!*\
  !*** ./pages/api/chat.js ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__]);\nopenai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/chat.js - Simplified to use direct Supabase queries\n\n\nconst client = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nconsole.log(\"Environment check:\", {\n    hasSupabaseUrl: !!\"https://apftqchtwcwrnkmjzhcr.supabase.co\",\n    hasServiceKey: !!process.env.SUPABASE_SERVICE_ROLE_KEY,\n    hasOpenAI: !!process.env.OPENAI_API_KEY,\n    supabaseUrlPreview: \"https://apftqchtwcwrnkmjzhcr.supabase.co\"?.substring(0, 30) + \"...\"\n});\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        console.log(\"=== CHAT API DEBUG START ===\");\n        const { message } = req.body;\n        console.log(\"Received message:\", message);\n        if (!message) {\n            return res.status(400).json({\n                error: \"Message is required\"\n            });\n        }\n        if (!process.env.OPENAI_API_KEY) {\n            console.log(\"OpenAI API key missing\");\n            return res.status(500).json({\n                error: \"OpenAI API key not configured\"\n            });\n        }\n        // Direct Supabase query - bypass the dataStore entirely\n        console.log(\"Querying Supabase directly...\");\n        let bankData = null;\n        let gstData = null;\n        let pnlData = null;\n        try {\n            const supabaseUrl = \"https://apftqchtwcwrnkmjzhcr.supabase.co\";\n            const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n            if (!supabaseUrl || !supabaseServiceKey) {\n                console.error(\"Missing Supabase environment variables\");\n                return res.status(500).json({\n                    error: \"Supabase not configured\"\n                });\n            }\n            const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey, {\n                auth: {\n                    autoRefreshToken: false,\n                    persistSession: false\n                }\n            });\n            // Query bank data\n            const { data: bankResults, error: bankError } = await supabase.from(\"transactions\").select(\"*\").order(\"created_at\", {\n                ascending: false\n            }).limit(1);\n            console.log(\"Bank query results:\", {\n                error: bankError?.message,\n                hasResults: !!bankResults,\n                resultsLength: bankResults?.length\n            });\n            if (bankResults && bankResults.length > 0) {\n                const rawBankData = bankResults[0];\n                console.log(\"Raw bank data columns:\", Object.keys(rawBankData));\n                // Extract the actual transaction data\n                bankData = rawBankData.categorized_output || rawBankData.data || rawBankData.processed_data || rawBankData.transactions || rawBankData.transaction_data || rawBankData;\n                console.log(\"Extracted bank data:\", {\n                    type: typeof bankData,\n                    hasData: !!bankData,\n                    isObject: typeof bankData === \"object\",\n                    keys: bankData && typeof bankData === \"object\" ? Object.keys(bankData).slice(0, 10) : null,\n                    preview: typeof bankData === \"string\" ? bankData.substring(0, 200) : JSON.stringify(bankData).substring(0, 200)\n                });\n            }\n            // Query GST data (optional - won't fail if table doesn't exist)\n            try {\n                const { data: gstResults } = await supabase.from(\"gst3b\").select(\"*\").order(\"created_at\", {\n                    ascending: false\n                }).limit(1);\n                if (gstResults && gstResults.length > 0) {\n                    gstData = gstResults[0].data || gstResults[0].gst_ocr_output || gstResults[0];\n                }\n            } catch (gstError) {\n                console.log(\"GST table query failed (might not exist):\", gstError.message);\n            }\n            // Query P&L data (optional)\n            try {\n                const { data: pnlResults } = await supabase.from(\"pnl\").select(\"*\").order(\"created_at\", {\n                    ascending: false\n                }).limit(1);\n                if (pnlResults && pnlResults.length > 0) {\n                    pnlData = pnlResults[0].data || pnlResults[0].pnl_ocr_output || pnlResults[0];\n                }\n            } catch (pnlError) {\n                console.log(\"P&L table query failed (might not exist):\", pnlError.message);\n            }\n        } catch (supabaseError) {\n            console.error(\"Supabase query error:\", supabaseError);\n            return res.status(500).json({\n                error: \"Failed to fetch data from database\",\n                details:  true ? supabaseError.message : 0\n            });\n        }\n        console.log(\"Final data status:\", {\n            hasBank: !!bankData,\n            hasGST: !!gstData,\n            hasPNL: !!pnlData,\n            bankDataType: typeof bankData\n        });\n        // Helper function to format data for the prompt\n        const formatDataForPrompt = (data, dataType)=>{\n            if (!data) {\n                return `Not provided - Please upload ${dataType}`;\n            }\n            try {\n                if (typeof data === \"string\") {\n                    return data.length > 4000 ? data.substring(0, 4000) + \"...[truncated]\" : data;\n                }\n                const jsonString = JSON.stringify(data, null, 2);\n                return jsonString.length > 4000 ? jsonString.substring(0, 4000) + \"...[truncated]\" : jsonString;\n            } catch (error) {\n                console.error(`Error formatting ${dataType}:`, error);\n                return `Data available but formatting error: ${error.message}`;\n            }\n        };\n        const systemPrompt = `You are a financial assistant chatbot specialized in analyzing financial documents.\n\nAvailable Data:\n==============\n\nBank Statement Data:\n${formatDataForPrompt(bankData, \"bank statement\")}\n\nGST Data:\n${formatDataForPrompt(gstData, \"GST return\")}\n\nP&L Data:\n${formatDataForPrompt(pnlData, \"P&L statement\")}\n\nInstructions:\n============\n- Analyze the actual financial data provided above to answer questions\n- For bank statements: Look for transactions, balances, income, expenses, cash flow patterns\n- For GST data: Analyze tax liability, input/output tax, compliance status  \n- For P&L data: Review revenue, expenses, profit margins, financial performance\n- If data shows \"Not provided\", inform the user to upload that document type\n- Provide specific insights with numbers, totals, and trends from the actual data\n- Calculate summaries, averages, and financial ratios when possible\n- Be detailed and helpful in your financial analysis`;\n        console.log(\"System prompt created, length:\", systemPrompt.length);\n        console.log(\"Calling OpenAI...\");\n        const completion = await client.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                {\n                    role: \"user\",\n                    content: message\n                }\n            ],\n            temperature: 0.7,\n            max_tokens: 1500\n        });\n        const reply = completion.choices[0].message.content;\n        console.log(\"OpenAI response received successfully, length:\", reply.length);\n        res.status(200).json({\n            reply\n        });\n    } catch (error) {\n        console.error(\"=== CHAT API ERROR ===\");\n        console.error(\"Error details:\", {\n            name: error.name,\n            message: error.message,\n            stack: error.stack\n        });\n        // More specific error handling\n        if (error.code === \"insufficient_quota\") {\n            return res.status(500).json({\n                error: \"OpenAI API quota exceeded. Please check your billing.\"\n            });\n        } else if (error.code === \"invalid_api_key\") {\n            return res.status(500).json({\n                error: \"Invalid OpenAI API key\"\n            });\n        } else if (error.name === \"TypeError\" && error.message.includes(\"fetch\")) {\n            return res.status(500).json({\n                error: \"Network error connecting to OpenAI\"\n            });\n        }\n        res.status(200).json({\n            reply: \"I'm having trouble accessing your financial data right now. Please make sure your bank statement is properly uploaded and try again.\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsT0FBTztZQUNUO1FBQ0YsT0FBTyxJQUFJQSxNQUFNa0UsSUFBSSxLQUFLLGVBQWVsRSxNQUFNQyxPQUFPLENBQUNvRSxRQUFRLENBQUMsVUFBVTtZQUN4RSxPQUFPekUsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFDMUJDLE9BQU87WUFDVDtRQUNGO1FBRUFKLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDbkJpRSxPQUFPO1FBQ1Q7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmFuay1zdGF0ZW1lbnQtcmVhZGVyLy4vcGFnZXMvYXBpL2NoYXQuanM/MWM0OSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvY2hhdC5qcyAtIFNpbXBsaWZpZWQgdG8gdXNlIGRpcmVjdCBTdXBhYmFzZSBxdWVyaWVzXG5pbXBvcnQgT3BlbkFJIGZyb20gXCJvcGVuYWlcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbmNvbnN0IGNsaWVudCA9IG5ldyBPcGVuQUkoe1xuICBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLFxufSk7XG5cbmNvbnNvbGUubG9nKCdFbnZpcm9ubWVudCBjaGVjazonLCB7XG4gIGhhc1N1cGFiYXNlVXJsOiAhIXByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCxcbiAgaGFzU2VydmljZUtleTogISFwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZLFxuICBoYXNPcGVuQUk6ICEhcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gIHN1cGFiYXNlVXJsUHJldmlldzogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMPy5zdWJzdHJpbmcoMCwgMzApICsgJy4uLidcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBcIk1ldGhvZCBub3QgYWxsb3dlZFwiIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnPT09IENIQVQgQVBJIERFQlVHIFNUQVJUID09PScpO1xuICAgIFxuICAgIGNvbnN0IHsgbWVzc2FnZSB9ID0gcmVxLmJvZHk7XG4gICAgY29uc29sZS5sb2coJ1JlY2VpdmVkIG1lc3NhZ2U6JywgbWVzc2FnZSk7XG5cbiAgICBpZiAoIW1lc3NhZ2UpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIk1lc3NhZ2UgaXMgcmVxdWlyZWRcIiB9KTtcbiAgICB9XG5cbiAgICBpZiAoIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZKSB7XG4gICAgICBjb25zb2xlLmxvZygnT3BlbkFJIEFQSSBrZXkgbWlzc2luZycpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IFwiT3BlbkFJIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWRcIiB9KTtcbiAgICB9XG5cbiAgICAvLyBEaXJlY3QgU3VwYWJhc2UgcXVlcnkgLSBieXBhc3MgdGhlIGRhdGFTdG9yZSBlbnRpcmVseVxuICAgIGNvbnNvbGUubG9nKCdRdWVyeWluZyBTdXBhYmFzZSBkaXJlY3RseS4uLicpO1xuICAgIGxldCBiYW5rRGF0YSA9IG51bGw7XG4gICAgbGV0IGdzdERhdGEgPSBudWxsO1xuICAgIGxldCBwbmxEYXRhID0gbnVsbDtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gICAgICBjb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xuICAgICAgXG4gICAgICBpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignTWlzc2luZyBTdXBhYmFzZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMnKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IFwiU3VwYWJhc2Ugbm90IGNvbmZpZ3VyZWRcIiB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSwge1xuICAgICAgICBhdXRoOiB7XG4gICAgICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBRdWVyeSBiYW5rIGRhdGFcbiAgICAgIGNvbnN0IHsgZGF0YTogYmFua1Jlc3VsdHMsIGVycm9yOiBiYW5rRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd0cmFuc2FjdGlvbnMnKVxuICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgY29uc29sZS5sb2coJ0JhbmsgcXVlcnkgcmVzdWx0czonLCB7XG4gICAgICAgIGVycm9yOiBiYW5rRXJyb3I/Lm1lc3NhZ2UsXG4gICAgICAgIGhhc1Jlc3VsdHM6ICEhYmFua1Jlc3VsdHMsXG4gICAgICAgIHJlc3VsdHNMZW5ndGg6IGJhbmtSZXN1bHRzPy5sZW5ndGhcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoYmFua1Jlc3VsdHMgJiYgYmFua1Jlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCByYXdCYW5rRGF0YSA9IGJhbmtSZXN1bHRzWzBdO1xuICAgICAgICBjb25zb2xlLmxvZygnUmF3IGJhbmsgZGF0YSBjb2x1bW5zOicsIE9iamVjdC5rZXlzKHJhd0JhbmtEYXRhKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBFeHRyYWN0IHRoZSBhY3R1YWwgdHJhbnNhY3Rpb24gZGF0YVxuICAgICAgICBiYW5rRGF0YSA9IHJhd0JhbmtEYXRhLmNhdGVnb3JpemVkX291dHB1dCB8fCBcbiAgICAgICAgICAgICAgICAgIHJhd0JhbmtEYXRhLmRhdGEgfHwgXG4gICAgICAgICAgICAgICAgICByYXdCYW5rRGF0YS5wcm9jZXNzZWRfZGF0YSB8fFxuICAgICAgICAgICAgICAgICAgcmF3QmFua0RhdGEudHJhbnNhY3Rpb25zIHx8XG4gICAgICAgICAgICAgICAgICByYXdCYW5rRGF0YS50cmFuc2FjdGlvbl9kYXRhIHx8XG4gICAgICAgICAgICAgICAgICByYXdCYW5rRGF0YTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0ZWQgYmFuayBkYXRhOicsIHtcbiAgICAgICAgICB0eXBlOiB0eXBlb2YgYmFua0RhdGEsXG4gICAgICAgICAgaGFzRGF0YTogISFiYW5rRGF0YSxcbiAgICAgICAgICBpc09iamVjdDogdHlwZW9mIGJhbmtEYXRhID09PSAnb2JqZWN0JyxcbiAgICAgICAgICBrZXlzOiBiYW5rRGF0YSAmJiB0eXBlb2YgYmFua0RhdGEgPT09ICdvYmplY3QnID8gT2JqZWN0LmtleXMoYmFua0RhdGEpLnNsaWNlKDAsIDEwKSA6IG51bGwsXG4gICAgICAgICAgcHJldmlldzogdHlwZW9mIGJhbmtEYXRhID09PSAnc3RyaW5nJyA/IGJhbmtEYXRhLnN1YnN0cmluZygwLCAyMDApIDogSlNPTi5zdHJpbmdpZnkoYmFua0RhdGEpLnN1YnN0cmluZygwLCAyMDApXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBRdWVyeSBHU1QgZGF0YSAob3B0aW9uYWwgLSB3b24ndCBmYWlsIGlmIHRhYmxlIGRvZXNuJ3QgZXhpc3QpXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGRhdGE6IGdzdFJlc3VsdHMgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgLmZyb20oJ2dzdDNiJylcbiAgICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAgICAgICAubGltaXQoMSk7XG4gICAgICAgICAgXG4gICAgICAgIGlmIChnc3RSZXN1bHRzICYmIGdzdFJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGdzdERhdGEgPSBnc3RSZXN1bHRzWzBdLmRhdGEgfHwgZ3N0UmVzdWx0c1swXS5nc3Rfb2NyX291dHB1dCB8fCBnc3RSZXN1bHRzWzBdO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChnc3RFcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZygnR1NUIHRhYmxlIHF1ZXJ5IGZhaWxlZCAobWlnaHQgbm90IGV4aXN0KTonLCBnc3RFcnJvci5tZXNzYWdlKTtcbiAgICAgIH1cblxuICAgICAgLy8gUXVlcnkgUCZMIGRhdGEgKG9wdGlvbmFsKVxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkYXRhOiBwbmxSZXN1bHRzIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCdwbmwnKVxuICAgICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgICBcbiAgICAgICAgaWYgKHBubFJlc3VsdHMgJiYgcG5sUmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcG5sRGF0YSA9IHBubFJlc3VsdHNbMF0uZGF0YSB8fCBwbmxSZXN1bHRzWzBdLnBubF9vY3Jfb3V0cHV0IHx8IHBubFJlc3VsdHNbMF07XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKHBubEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQJkwgdGFibGUgcXVlcnkgZmFpbGVkIChtaWdodCBub3QgZXhpc3QpOicsIHBubEVycm9yLm1lc3NhZ2UpO1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoc3VwYWJhc2VFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignU3VwYWJhc2UgcXVlcnkgZXJyb3I6Jywgc3VwYWJhc2VFcnJvcik7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgICAgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIGRhdGEgZnJvbSBkYXRhYmFzZVwiLFxuICAgICAgICBkZXRhaWxzOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IHN1cGFiYXNlRXJyb3IubWVzc2FnZSA6IHVuZGVmaW5lZFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ0ZpbmFsIGRhdGEgc3RhdHVzOicsIHtcbiAgICAgIGhhc0Jhbms6ICEhYmFua0RhdGEsXG4gICAgICBoYXNHU1Q6ICEhZ3N0RGF0YSxcbiAgICAgIGhhc1BOTDogISFwbmxEYXRhLFxuICAgICAgYmFua0RhdGFUeXBlOiB0eXBlb2YgYmFua0RhdGFcbiAgICB9KTtcblxuICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBmb3JtYXQgZGF0YSBmb3IgdGhlIHByb21wdFxuICAgIGNvbnN0IGZvcm1hdERhdGFGb3JQcm9tcHQgPSAoZGF0YSwgZGF0YVR5cGUpID0+IHtcbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICByZXR1cm4gYE5vdCBwcm92aWRlZCAtIFBsZWFzZSB1cGxvYWQgJHtkYXRhVHlwZX1gO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGEubGVuZ3RoID4gNDAwMCA/IGRhdGEuc3Vic3RyaW5nKDAsIDQwMDApICsgJy4uLlt0cnVuY2F0ZWRdJyA6IGRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGpzb25TdHJpbmcgPSBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKTtcbiAgICAgICAgcmV0dXJuIGpzb25TdHJpbmcubGVuZ3RoID4gNDAwMCA/IFxuICAgICAgICAgIGpzb25TdHJpbmcuc3Vic3RyaW5nKDAsIDQwMDApICsgJy4uLlt0cnVuY2F0ZWRdJyA6IFxuICAgICAgICAgIGpzb25TdHJpbmc7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBmb3JtYXR0aW5nICR7ZGF0YVR5cGV9OmAsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIGBEYXRhIGF2YWlsYWJsZSBidXQgZm9ybWF0dGluZyBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWA7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGBZb3UgYXJlIGEgZmluYW5jaWFsIGFzc2lzdGFudCBjaGF0Ym90IHNwZWNpYWxpemVkIGluIGFuYWx5emluZyBmaW5hbmNpYWwgZG9jdW1lbnRzLlxuXG5BdmFpbGFibGUgRGF0YTpcbj09PT09PT09PT09PT09XG5cbkJhbmsgU3RhdGVtZW50IERhdGE6XG4ke2Zvcm1hdERhdGFGb3JQcm9tcHQoYmFua0RhdGEsIFwiYmFuayBzdGF0ZW1lbnRcIil9XG5cbkdTVCBEYXRhOlxuJHtmb3JtYXREYXRhRm9yUHJvbXB0KGdzdERhdGEsIFwiR1NUIHJldHVyblwiKX1cblxuUCZMIERhdGE6XG4ke2Zvcm1hdERhdGFGb3JQcm9tcHQocG5sRGF0YSwgXCJQJkwgc3RhdGVtZW50XCIpfVxuXG5JbnN0cnVjdGlvbnM6XG49PT09PT09PT09PT1cbi0gQW5hbHl6ZSB0aGUgYWN0dWFsIGZpbmFuY2lhbCBkYXRhIHByb3ZpZGVkIGFib3ZlIHRvIGFuc3dlciBxdWVzdGlvbnNcbi0gRm9yIGJhbmsgc3RhdGVtZW50czogTG9vayBmb3IgdHJhbnNhY3Rpb25zLCBiYWxhbmNlcywgaW5jb21lLCBleHBlbnNlcywgY2FzaCBmbG93IHBhdHRlcm5zXG4tIEZvciBHU1QgZGF0YTogQW5hbHl6ZSB0YXggbGlhYmlsaXR5LCBpbnB1dC9vdXRwdXQgdGF4LCBjb21wbGlhbmNlIHN0YXR1cyAgXG4tIEZvciBQJkwgZGF0YTogUmV2aWV3IHJldmVudWUsIGV4cGVuc2VzLCBwcm9maXQgbWFyZ2lucywgZmluYW5jaWFsIHBlcmZvcm1hbmNlXG4tIElmIGRhdGEgc2hvd3MgXCJOb3QgcHJvdmlkZWRcIiwgaW5mb3JtIHRoZSB1c2VyIHRvIHVwbG9hZCB0aGF0IGRvY3VtZW50IHR5cGVcbi0gUHJvdmlkZSBzcGVjaWZpYyBpbnNpZ2h0cyB3aXRoIG51bWJlcnMsIHRvdGFscywgYW5kIHRyZW5kcyBmcm9tIHRoZSBhY3R1YWwgZGF0YVxuLSBDYWxjdWxhdGUgc3VtbWFyaWVzLCBhdmVyYWdlcywgYW5kIGZpbmFuY2lhbCByYXRpb3Mgd2hlbiBwb3NzaWJsZVxuLSBCZSBkZXRhaWxlZCBhbmQgaGVscGZ1bCBpbiB5b3VyIGZpbmFuY2lhbCBhbmFseXNpc2A7XG5cbiAgICBjb25zb2xlLmxvZygnU3lzdGVtIHByb21wdCBjcmVhdGVkLCBsZW5ndGg6Jywgc3lzdGVtUHJvbXB0Lmxlbmd0aCk7XG5cbiAgICBjb25zb2xlLmxvZygnQ2FsbGluZyBPcGVuQUkuLi4nKTtcbiAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgY2xpZW50LmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBcImdwdC00by1taW5pXCIsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7IHJvbGU6IFwic3lzdGVtXCIsIGNvbnRlbnQ6IHN5c3RlbVByb21wdCB9LFxuICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiBtZXNzYWdlIH0sXG4gICAgICBdLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgIG1heF90b2tlbnM6IDE1MDAsXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXBseSA9IGNvbXBsZXRpb24uY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgY29uc29sZS5sb2coJ09wZW5BSSByZXNwb25zZSByZWNlaXZlZCBzdWNjZXNzZnVsbHksIGxlbmd0aDonLCByZXBseS5sZW5ndGgpO1xuXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyByZXBseSB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCI9PT0gQ0hBVCBBUEkgRVJST1IgPT09XCIpO1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZXRhaWxzOlwiLCB7XG4gICAgICBuYW1lOiBlcnJvci5uYW1lLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgIHN0YWNrOiBlcnJvci5zdGFja1xuICAgIH0pO1xuICAgIFxuICAgIC8vIE1vcmUgc3BlY2lmaWMgZXJyb3IgaGFuZGxpbmdcbiAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ2luc3VmZmljaWVudF9xdW90YScpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgICBlcnJvcjogXCJPcGVuQUkgQVBJIHF1b3RhIGV4Y2VlZGVkLiBQbGVhc2UgY2hlY2sgeW91ciBiaWxsaW5nLlwiIFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnJvci5jb2RlID09PSAnaW52YWxpZF9hcGlfa2V5Jykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXG4gICAgICAgIGVycm9yOiBcIkludmFsaWQgT3BlbkFJIEFQSSBrZXlcIiBcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyb3IubmFtZSA9PT0gJ1R5cGVFcnJvcicgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnZmV0Y2gnKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXG4gICAgICAgIGVycm9yOiBcIk5ldHdvcmsgZXJyb3IgY29ubmVjdGluZyB0byBPcGVuQUlcIiBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICByZXBseTogXCJJJ20gaGF2aW5nIHRyb3VibGUgYWNjZXNzaW5nIHlvdXIgZmluYW5jaWFsIGRhdGEgcmlnaHQgbm93LiBQbGVhc2UgbWFrZSBzdXJlIHlvdXIgYmFuayBzdGF0ZW1lbnQgaXMgcHJvcGVybHkgdXBsb2FkZWQgYW5kIHRyeSBhZ2Fpbi5cIlxuICAgIH0pO1xuICB9XG59Il0sIm5hbWVzIjpbIk9wZW5BSSIsImNyZWF0ZUNsaWVudCIsImNsaWVudCIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImNvbnNvbGUiLCJsb2ciLCJoYXNTdXBhYmFzZVVybCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsImhhc1NlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiaGFzT3BlbkFJIiwic3VwYWJhc2VVcmxQcmV2aWV3Iiwic3Vic3RyaW5nIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJib2R5IiwiYmFua0RhdGEiLCJnc3REYXRhIiwicG5sRGF0YSIsInN1cGFiYXNlVXJsIiwic3VwYWJhc2VTZXJ2aWNlS2V5Iiwic3VwYWJhc2UiLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwiZGF0YSIsImJhbmtSZXN1bHRzIiwiYmFua0Vycm9yIiwiZnJvbSIsInNlbGVjdCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwibGltaXQiLCJoYXNSZXN1bHRzIiwicmVzdWx0c0xlbmd0aCIsImxlbmd0aCIsInJhd0JhbmtEYXRhIiwiT2JqZWN0Iiwia2V5cyIsImNhdGVnb3JpemVkX291dHB1dCIsInByb2Nlc3NlZF9kYXRhIiwidHJhbnNhY3Rpb25zIiwidHJhbnNhY3Rpb25fZGF0YSIsInR5cGUiLCJoYXNEYXRhIiwiaXNPYmplY3QiLCJzbGljZSIsInByZXZpZXciLCJKU09OIiwic3RyaW5naWZ5IiwiZ3N0UmVzdWx0cyIsImdzdF9vY3Jfb3V0cHV0IiwiZ3N0RXJyb3IiLCJwbmxSZXN1bHRzIiwicG5sX29jcl9vdXRwdXQiLCJwbmxFcnJvciIsInN1cGFiYXNlRXJyb3IiLCJkZXRhaWxzIiwidW5kZWZpbmVkIiwiaGFzQmFuayIsImhhc0dTVCIsImhhc1BOTCIsImJhbmtEYXRhVHlwZSIsImZvcm1hdERhdGFGb3JQcm9tcHQiLCJkYXRhVHlwZSIsImpzb25TdHJpbmciLCJzeXN0ZW1Qcm9tcHQiLCJjb21wbGV0aW9uIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibW9kZWwiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidGVtcGVyYXR1cmUiLCJtYXhfdG9rZW5zIiwicmVwbHkiLCJjaG9pY2VzIiwibmFtZSIsInN0YWNrIiwiY29kZSIsImluY2x1ZGVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/chat.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();